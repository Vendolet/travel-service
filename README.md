# travelService "Сервис оценок путешественниками достопримечательностей"
REST API (php)
## Краткое описание.

### Технологии
- Разработка приложения велась для сервера Apache, PHP8.0.
- Используемая БД - MySQL 5.7.
- Микрофреймворк для роутинга - Slim4.

### Особенности
- Реализованный сервис оперирует с 4 сущностями: путешественники (traveler), достопримечательности (place), 
города (city), оценки (score). 
- Реализована регистрация, аутентификация, авторизация пользователя.
- Запросы на манипуляции с добавлением, изменением, удалением оценки доступны только авторизованным пользователям.
- Регистрация автоматически приводит к аутентификация нового пользователя.
- Запросы регистрации и аутентификация доступны только неавторизованным пользователям.
- Запрос разлогина доступен только авторизованному пользователю.
- Запросы связанные с изменениями оценок запускают пересчёт рейтинга целевой достопримечательности.
- Запросы на изменение оценки может проводить только пользователь их создавший.
- Обмен данными идёт в формате JSON.

---
## Реализованные запросы.
### Путешественник (traveler)
- Получить всех путешественников: GET '/traveler'. _(возвращает список пользователей)_
- Получить информацию об путешественнике: GET '/traveler/{$id}' _(возвращает пользователя по ID, а так же его оценки и посещённые города)_
- Зарегистрировать пользователя: POST '/signup'. _(возвращает нового пользователя с номером телефона)_
- Авторизация пользователя: POST '/login'.  _(возвращает пользователя с номером телефона)_
- Разлогинить пользователя: GET '/logout'.
### Достопримечательность (place)
- Получить все достопримечательности: GET '/place'. _(возвращает все достопримечательности с названиями городов)_
- Получить отфильтрованные достопримечательности: POST '/place'. _(позволяет фильтровать достопримечательности по удалённости, рейтингу, городу)_
- Информация по достопримечательности: GET 'place/{$id}' _(возвращает достопримечательность с названием города и её оценки)_
### Город (city)
- Список всех городов: GET '/city' _(возвращает список всех городов)_
- Информация о городе: GET '/city/{$id}' _(возвращает посетивших пользователей и местные достопримечательности)_

### Оценки (score)
- Получить оценки: GET '/score'. _(возвращает оценки)_
- Добавить оценку: POST '/score'. _(возвращает оценённое место и его оценки)_
- Изменить оценку: PUT '/score'. _(возвращает все оценки пользователя)_
- Удалить оценку: DELETE '/score'. _(возвращает другие оценки пользователя)_

---
## Подробное описание POST, PUT, DELETE запросов (наглядно в файле test.json)

- Получить отфильтрованные достопримечательности: POST '/place'. Принимаемы параметры:
  * "city" - делает выборку по городам. Может быть:
    + массив простых чисел - выборка по ID городов.
    + пустой массив - без выборки.
  * "rank" - определяет сортировку по рейтингу. Строка на выбор:
    + "max" - сначала максимальный рейтинг;
    + "min" - сначала минимальный рейтинг;
    + "0" - без сортировки по рейтингу4
  * "distance" - определяет сортировку по удалённости. Строка на выбор:
    + "max" - сначала самые удалённые от центра;
    + "min" - сначала самые близкие к центру;
    + "0" - без сортировки по удалённости;

- Добавить оценку: POST '/score'. Принимаемы параметры:
  * "score" - величина оценки. Простое число от 1 до 10.
  * "place_id" - оцениваемое место. Простое число. Место должно существовать.
  * Пользователь должен быть авторизован.
  * Оценки этого места от этого пользователя не должно существовать.
- Изменить оценку: PUT '/score'. 
  * "id" - ID оценки. Простое число. Оценка должна существовать.
  * "score" - величина оценки. Простое число от 1 до 10.
  * Пользователь должен быть авторизован.
  * Оценка этого места от этого пользователя должна существовать.
- Удалить оценку: DELETE '/score'. 
  * "id" - ID оценки. Простое число. Оценка должна существовать.
  * Пользователь должен быть авторизован.
  * Оценка этого места от этого пользователя должна существовать.
- Зарегистрировать пользователя: POST '/signup'. 
  * "name_traveler" -  только буквенные символы.
  * "phone" - 11 чисел. Уникальное значение.
  * Пользователь НЕ должен быть авторизован.
  * "password" - просто обязательное поле.
- Авторизация пользователя: POST '/login'. 
    * "phone" - 11 чисел. Должно существовать в БД.
    * "password" - пароль от записи.

---
## Запуск приложения.

1. Загрузить проект.
2. Выполнить установку зависимостей Composer ```composer install```.
3. В файле ```/app/config/db.php ``` ввести данные собственной БД.
4. В папке ```/database/sql``` находится файл для создания таблиц (файл ```create.sql```).
5. Там же есть файл ```insert.sql``` для заполнения таблиц тестовыми данными.
6. В файле ```test.json``` есть образцы запросов для методов с POST, PUT, DELETE проекта.
7. Изменить маршруты можно в файле ```/app/bootstrap.php```, изменив первый строковый аргумент.
